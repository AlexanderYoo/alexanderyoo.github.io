---
import { PERSONAL_INFO } from "../../data/personal";
import { NAVIGATION_DATA } from "../../data/navigation";

const isHomePage = Astro.url.pathname === "/";
const resolveHref = (href: string) => {
  if (!href.startsWith("#")) {
    return href;
  }
  return isHomePage ? href : `/${href}`;
};
---

<div class="relative">
  <nav
    class="fixed top-0 left-0 z-50 w-full border-b border-white/10 bg-gray-950/20 backdrop-blur-md"
    aria-label="Main navigation"
  >
    <div class="mx-auto flex max-w-7xl items-center justify-between px-6 py-3">
      <a href="/" class="flex items-center gap-3">
        <img
          src="/images/yoo_code_logo.png"
          alt=""
          aria-hidden="true"
          class="size-9 rounded-sm object-contain"
          loading="eager"
          decoding="async"
        />
        <h3 class="text-2xl font-bold text-white">{PERSONAL_INFO.brand}</h3>
      </a>

      <ul class="hidden space-x-8 md:flex">
        {
          NAVIGATION_DATA.navigationMenu &&
            NAVIGATION_DATA.navigationMenu.map((item) => (
              <li>
                <a
                  href={resolveHref(item.href)}
                  class="group relative rounded-sm text-white transition-colors duration-150 hover:text-secondary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary"
                >
                  <span class="absolute left-0 -bottom-2 h-0.5 w-0 bg-secondary transition-all duration-150 group-hover:w-full"></span>
                  {item.label}
                </a>
              </li>
            ))
        }
      </ul>

      <button
        id="mobile-menu-toggle"
        type="button"
        class="z-50 flex items-center rounded-sm md:hidden focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary"
        aria-label="Toggle navigation menu"
        aria-controls="mobile-menu"
        aria-expanded="false"
      >
        <svg
          class="size-6 text-white"
          data-menu-icon="open"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
        <svg
          class="hidden size-6 text-white"
          data-menu-icon="close"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
  </nav>

  <button
    id="mobile-menu-overlay"
    type="button"
    aria-label="Close navigation menu"
    class="fixed inset-0 z-40 hidden bg-black/60"
  ></button>

  <div
    id="mobile-menu"
    class="fixed top-0 right-0 z-50 h-full w-64 translate-x-full transform bg-gray-900 shadow-lg transition-transform duration-150"
    aria-hidden="true"
  >
    <ul class="ml-6 mt-10 flex flex-col space-y-6">
      {
        NAVIGATION_DATA.navigationMenu.map((item) => (
          <li>
            <a
              data-mobile-link
              href={resolveHref(item.href)}
              class="rounded-sm text-lg text-white hover:text-secondary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary"
            >
              {item.label}
            </a>
          </li>
        ))
      }
      <li>
        <a
          data-mobile-link
          href={resolveHref("#contact")}
          class="inline-block rounded-3xl bg-primary px-6 py-3 text-white transition-colors duration-150 hover:bg-secondary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary"
        >
          Contact me
        </a>
      </li>
    </ul>
  </div>
</div>

<script>
  const toggle = document.getElementById("mobile-menu-toggle");
  const menu = document.getElementById("mobile-menu");
  const overlay = document.getElementById("mobile-menu-overlay");
  const openIcon = toggle?.querySelector('[data-menu-icon="open"]');
  const closeIcon = toggle?.querySelector('[data-menu-icon="close"]');
  const mobileLinks = menu?.querySelectorAll("[data-mobile-link]");

  const setMenuState = (isOpen) => {
    if (!toggle || !menu || !overlay || !openIcon || !closeIcon) return;
    toggle.setAttribute("aria-expanded", String(isOpen));
    menu.setAttribute("aria-hidden", String(!isOpen));
    menu.classList.toggle("translate-x-full", !isOpen);
    overlay.classList.toggle("hidden", !isOpen);
    openIcon.classList.toggle("hidden", isOpen);
    closeIcon.classList.toggle("hidden", !isOpen);
    document.body.classList.toggle("overflow-hidden", isOpen);
  };

  const isOpen = () => toggle?.getAttribute("aria-expanded") === "true";

  toggle?.addEventListener("click", () => {
    setMenuState(!isOpen());
  });

  overlay?.addEventListener("click", () => setMenuState(false));
  mobileLinks?.forEach((link) => {
    link.addEventListener("click", () => setMenuState(false));
  });

  window.addEventListener("keydown", (event) => {
    if (event.key === "Escape" && isOpen()) {
      setMenuState(false);
    }
  });
</script>
